generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  // precisa da extensão se usar @db.Citext
  extensions = [citext()]
}

enum DocumentType {
  CPF
  RG
}

enum InviteStatus {
  PENDING
  CHECKED_IN
  REVOKED
}

model GuestInvite {
  id             String        @id @default(uuid())

  fullName       String        @db.VarChar(120)

  // únicos individuais para idempotência real
  email          String        @db.Citext @unique
  phone          String        @db.VarChar(14) @unique

  documentType   DocumentType?
  documentNumber String?       @db.VarChar(14)

  company        String?       @db.VarChar(120)
  jobTitle       String?       @db.VarChar(120)

  // token único para facilitar /api/checkin?t=...
  checkInToken   String?       @db.VarChar(64) @unique
  status         InviteStatus  @default(PENDING)
  checkInAt      DateTime?

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  state          String?       @db.VarChar(2)
  city           String?       @db.VarChar(120)

  // índices úteis
  @@index([createdAt])
  @@index([status])
  @@index([state, city])

  
  @@unique([documentType, documentNumber])
}
